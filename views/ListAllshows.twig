<!DOCTYPE html>
<html>
	<head>
		<title>List All Shows</title>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet" href="https://cdn.datatables.net/1.10.25/css/dataTables.bootstrap5.min.css">
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
		<style>
			.table-responsive {
				overflow-x: auto;
			}
		</style>
	</head>
	<body>
		<div class="container">
			<div class="table-responsive">
				<br/>
				<h3 align="center">ALL Manual Added Shows</h3>
				<a class="btn btn-primary mb-2" href="../app">+ Add New</a>
				<a class="btn btn-primary mb-2" href="../app/edit-cities">Cities</a>
				<a class="btn btn-primary mb-2" href="../app/edit-halls">Halls</a>
				<br/>
				<table id="showsTable" class="table table-striped table-bordered">
					<thead>
						<tr>
							<th>Name</th>
							<th>Domain</th>
							<th>Section</th>

							<th>Show Locations</th>
						</tr>
					</thead>
					<tbody>
						{% for key, row in response %}
							<tr>
								<td>{{ row.name }}</td>
								<td>{{ row.domain }}</td>
								<td>{{ row.section }}</td>

								<td>
									<button class="btn btn-info" data-bs-toggle="modal" data-bs-target="#showLocationsModal{{ key }}">Detail
									</button>
									<button class="btn btn-danger delete-button" data-objId="{{ row._id }}">Delete</button>

									<div class="modal fade" id="showLocationsModal{{ key }}" tabindex="-1" aria-labelledby="showLocationsModalLabel{{ key }}" aria-hidden="true">
										<div class="modal-dialog modal-dialog-centered modal-lg">
											<div class="modal-content">
												<div class="modal-header">
													<h5 class="modal-title" id="showLocationsModalLabel{{ key }}">Show Locations</h5>
													<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
												</div>
												<div class="modal-body">
													<table class="table">
														<thead>
															<tr>
																<th>Address</th>
																<th>Hall</th>
																<th>City</th>
																<th>Date</th>
																<th>Day</th>
																<th>Time</th>
																<th>Action</th>
															</tr>
														</thead>
														<tbody>
															{% for index, location in row.showLocations %}
																<tr>
																	<td>{{ location.address }}</td>
																	<td>{{ location.hall }}</td>
																	<td>{{ location.city }}</td>
																	<td>{{ location.date }}</td>
																	<td>{{ location.day }}</td>
																	<td>{{ location.time }}</td>
																	<td><button class="btn btn-danger delete-location-button" data-objId="{{ row._id }}" data-index="{{ index }}">Delete</button></td>
																</tr>
															{% endfor %}
														</tbody>
													</table>
												</div>
												<div class="modal-footer">
													<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close
													</button>
												</div>
											</div>
										</div>
									</div>
								</td>
							</tr>
						{% endfor %}
					</tbody>
				</table>
			</div>
		</div>

		<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
		<script src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.min.js"></script>
		<script src="https://cdn.datatables.net/1.10.25/js/dataTables.bootstrap5.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

		<script>
			$(document).ready(function () {
            $('#showsTable').DataTable({"ordering": false});
            });
		</script>
		
 <script>
    $(document).ready(function() {
        $('.delete-button').on('click', function() {
            var deleteButton = $(this); // Store the reference to the clicked button
            var objectId = deleteButton.data('objid'); // Use lowercased attribute name

            // Make an AJAX request to delete the record
            $.ajax({
                url: `delete-show/${objectId}`, // Endpoint URL with the ID parameter
                method: 'DELETE',
                success: function(response) {
                    // Handle success, maybe refresh the table or show a success message
                    console.log(response.message);
                    // Remove the deleted row from the table using the stored button reference
                    deleteButton.closest('tr').remove();
                    toastr.success('Deleted successfully!');
                },
                error: function(error) {
                    // Handle error, show an error message or log the error
                    console.error('Error deleting record:', error.responseJSON.error);
                    toastr.error('An error occurred while Deleting.');
                }
            });
        });
    });
</script>


<script>
    $(document).ready(function() {
        $('.delete-location-button').on('click', function() {
            var deleteButton = $(this);
            var objectId = deleteButton.data('objid');
            var index = deleteButton.data('index');

            // Make an AJAX request to delete the location detail
            $.ajax({
                url: 'deleteLocationDetail',
                method: 'DELETE',
                data: {
                    index: index,
                    showId: objectId
                },
                success: function(response) {
                    // Handle success, maybe refresh the table or show a success message
                    console.log(response);
                    // Remove the deleted row from the table using the stored button reference
                    deleteButton.closest('tr').remove();
                    toastr.success('Deleted successfully!');
                },
                error: function(error) {
                    // Handle error, show an error message or log the error
                    console.error('Error deleting location detail:', error.responseText);
                    toastr.error('An error occurred while Deleting.');
                }
            });
        });
    });
</script>



	</body>
</html>
